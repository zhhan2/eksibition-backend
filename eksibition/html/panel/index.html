<!doctype html>
<html lang="en" class="no-js">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="theme-color" content="#3e454c">
	
	<title>Eksibition - Dashboard</title>

	<!-- Font awesome -->
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<!-- Sandstone Bootstrap CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<!-- Bootstrap Datatables -->
	<link rel="stylesheet" href="css/dataTables.bootstrap.min.css">
	<!-- Bootstrap social button library -->
	<link rel="stylesheet" href="css/bootstrap-social.css">
	<!-- Bootstrap select -->
	<link rel="stylesheet" href="css/bootstrap-select.css">
	<!-- Bootstrap file input -->
	<link rel="stylesheet" href="css/fileinput.min.css">
	<!-- Awesome Bootstrap checkbox -->
	<link rel="stylesheet" href="css/awesome-bootstrap-checkbox.css">
	<!-- Admin Stye -->
	<link rel="stylesheet" href="css/style.css">

	<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
	<div class="brand clearfix">
		<a href="index.html" class="logo"><img src="img/logo.jpg" class="img-responsive" alt=""></a>
		<span class="menu-btn"><i class="fa fa-bars"></i></span>
		<ul class="ts-profile-nav">
			<li class="ts-account">
				<a href="#"><img src="img/ts-avatar.jpg" class="ts-avatar hidden-side" alt=""> Account <i class="fa fa-angle-down hidden-side"></i></a>
				<ul>
					<li><a href="#">My Account</a></li>
					<li><a href="#">Edit Account</a></li>
					<li><a href="#">Logout</a></li>
				</ul>
			</li>
		</ul>
	</div>

	<div class="ts-main-content">
		<nav class="ts-sidebar">
			<ul class="ts-sidebar-menu">
				<li class="ts-label">Main</li>
				<li class="open"><a href="home"><i class="fa fa-dashboard"></i> Dashboard</a></li>
				<li class=""><a href="itemList"><i class="fa fa-bars"></i> Items</a></li>
				<li class=""><a href="user"><i class="fa fa-users"></i> Users</a></li>
				<li class=""><a href="order"><i class="fa fa-sticky-note"></i> Orders</a></li>
				<li class=""><a href="newsList"><i class="fa fa-newspaper-o"></i> News</a></li>

				<!-- Account from above -->
				<ul class="ts-profile-nav">
					<li><a href="#">Help</a></li>
					<li><a href="#">Settings</a></li>
					<li class="ts-account">
						<a href="#"><img src="img/ts-avatar.jpg" class="ts-avatar hidden-side" alt=""> Account <i class="fa fa-angle-down hidden-side"></i></a>
						<ul>
							<li><a href="#">My Account</a></li>
							<li><a href="#">Edit Account</a></li>
							<li><a href="#">Logout</a></li>
						</ul>
					</li>
				</ul>

			</ul>
		</nav>
		<div class="content-wrapper">
			<div class="container-fluid">

				<div class="row">
					<div class="col-md-12">

						<h2 class="page-title" id="pageTitle">Dashboard</h2>
						<div id="mainContent">
							<div class="row">
								<div class="col-md-12">
									<div class="row">
										<div class="col-md-3">
											<div class="panel panel-default">
												<div class="panel-body bk-primary text-light">
													<div class="stat-panel text-center">
														<div class="stat-panel-number h1 " id="itemBlock">0</div>
														<div class="stat-panel-title text-uppercase">items</div>
													</div>
												</div>
												<a href="itemList" class="block-anchor panel-footer text-center" id="itemLink">See All &nbsp; <i class="fa fa-arrow-right"></i></a>
											</div>
										</div>
										<div class="col-md-3">
											<div class="panel panel-default">
												<div class="panel-body bk-success text-light">
													<div class="stat-panel text-center">
														<div class="stat-panel-number h1 " id="userBlock">0</div>
														<div class="stat-panel-title text-uppercase">users</div>
													</div>
												</div>
												<a href="user" class="block-anchor panel-footer text-center" id="userLink">See All &nbsp; <i class="fa fa-arrow-right"></i></a>
											</div>
										</div>
										<div class="col-md-3">
											<div class="panel panel-default">
												<div class="panel-body bk-info text-light">
													<div class="stat-panel text-center">
														<div class="stat-panel-number h1 " id="orderBlock">0</div>
														<div class="stat-panel-title text-uppercase">orders</div>
													</div>
												</div>
												<a href="order" class="block-anchor panel-footer text-center" id="orderLink">See All &nbsp; <i class="fa fa-arrow-right"></i></a>
											</div>
										</div>
										<div class="col-md-3">
											<div class="panel panel-default">
												<div class="panel-body bk-warning text-light">
													<div class="stat-panel text-center">
														<div class="stat-panel-number h1 " id="newsBlock">0</div>
														<div class="stat-panel-title text-uppercase">Pushed News</div>
													</div>
												</div>
												<a href="newsList" class="block-anchor panel-footer text-center" id="newsLink">See All &nbsp; <i class="fa fa-arrow-right"></i></a>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col-md-6">
									<div class="panel panel-default">
										<div class="panel-heading">Sales Report</div>
										<div class="panel-body">
											<div class="chart">
												<canvas id="dashReport" height="310" width="600"></canvas>
											</div>
											<div id="legendDiv"></div>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="panel panel-default">
										<div class="panel-heading">Recent Oreders</div>
										<div class="panel-body">
											<div class="alert alert-dismissible alert-success">
												<button type="button" class="close" data-dismiss="alert"><i class="fa fa-close"></i></button>
												<strong>Well done!</strong> You successfully read <a href="#" class="alert-link">this important alert message</a>.
											</div>
											<table class="table table-hover">
												<thead>
													<tr>
														<th>#</th>
														<th>Name</th>
														<th>Purchased Date</th>
														<th>Redeemed Date</th>
														<th>Valid</th>
													</tr>
												</thead>
												<tbody id="orderTableBody">
													
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>

	<!-- Loading Scripts -->
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap-select.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.dataTables.min.js"></script>
	<script src="js/dataTables.bootstrap.min.js"></script>
	<script src="js/Chart.min.js"></script>
	<script src="js/fileinput.js"></script>
	<script src="js/chartData.js"></script>
	<script src="js/main.js"></script>
	
	<script>
		
	window.onload = function(){
		// var ctx = document.getElementById("dashReport").getContext("2d");
		// window.myLine = new Chart(ctx).Line(swirlData, {
		// 	responsive: true,
		// 	scaleShowVerticalLines: false,
		// 	scaleBeginAtZero : true,
		// 	multiTooltipTemplate: "<%if (label){%><%=label%>: <%}%><%= value %>",
		// }); 
			
		getBlockValue();
		loadRecentOrder();
		loadChart();
	}

	function getBlockValue(){
		$.ajax({
			type: "POST",
			url: "https://elvinjin.com:8081/api/admin/count",
			cache: false,
			crossDomain: true,
			dataType: 'json',
			xhrFields: {
				withCredentials: true
			},
			success: function(data){
				// console.log(data);
	        	$('#itemBlock').html(data.item?data.item:0);
	        	// $('#itemLink').click(itemBlockClicked);
	        	$('#userBlock').html(data.user?data.user:0);
	        	$('#orderBlock').html(data.order?data.order:0);
	        	$('#newsBlock').html(data.news?data.news:0);
			}
		});
	}

	function loadRecentOrder(){
		$.ajax({
			type: "POST",
			url: "https://elvinjin.com:8081/api/admin/recentOrder",
			cache: false,
			crossDomain: false,
			dataType: 'json',
			xhrFields: {
				withCredentials: true
			},
			success: function(data){
				var tbody = document.getElementById('orderTableBody');
	        	for(var i = 0; i < data.length; i++){
	        		var tr = document.createElement('tr');
	        		var th = document.createElement('th');
	        		th.scope = "row";
	        		th.innerHTML = i+1;
	        		var name = document.createElement('td');
	        		name.innerHTML = data[i].name;
	        		var generateDate = document.createElement('td');
	        		generateDate.innerHTML = data[i].generateDate;
	        		var redeemedDate = document.createElement('td');
	        		redeemedDate.innerHTML = data[i].redeemedDate?data[i].redeemedDate:"Not available."
	        		var valid = document.createElement('td');
	        		valid.innerHTML = data[i].redeemedDate?"No":"Yes";
	        		tr.appendChild(th);
	        		tr.appendChild(name);
	        		tr.appendChild(generateDate);
	        		tr.appendChild(redeemedDate);
	        		tr.appendChild(valid);
	        		tbody.appendChild(tr);
	        	}
			}
		});
	}

	function loadChart(){
		$.ajax({
			type: "POST",
			url: "https://elvinjin.com:8081/api/admin/orderCountOnMonths",
			cache: false,
			crossDomain: false,
			dataType: 'json',
			xhrFields: {
				withCredentials: true
			},
			success: function(data){
				console.log(data);
				for(var i = 0; i < data.months.length; i++){
					switch(data.months[i]){
						case 0:
							data.months[i] = 'Jan.';
							break;
						case 1:
							data.months[i] = 'Feb.';
							break;
						case 2:
							data.months[i] = 'Mar.';
							break;
						case 3:
							data.months[i] = 'Apr.';
							break;
						case 4:
							data.months[i] = 'May.';
							break;
						case 5:
							data.months[i] = 'Jun.';
							break;
						case 6:
							data.months[i] = 'Jul.';
							break;
						case 7:
							data.months[i] = 'Aug.';
							break;
						case 8:
							data.months[i] = 'Sep.';
							break;
						case 9:
							data.months[i] = 'Oct.';
							break;
						case 10:
							data.months[i] = 'Nov.';
							break;
						case 11:
							data.months[i] = 'Dec.';
							break;
						default:
							break;
					}
				}
				var chartData = {
				    labels: data.months,
				    datasets: [
				        {
				            label: "Redeemed Tickets",
				            fillColor: "rgba(220,220,220,0.2)",
				            strokeColor: "rgba(220,220,220,1)",
				            pointColor: "rgba(220,220,220,1)",
				            pointStrokeColor: "#fff",
				            pointHighlightFill: "#fff",
				            pointHighlightStroke: "rgba(220,220,220,1)",
				            data: data.purchased
				        },
				        {
				            label: "Purchased Tickets",
				            fillColor: "rgba(151,187,205,0.2)",
				            strokeColor: "rgba(151,187,205,1)",
				            pointColor: "rgba(151,187,205,1)",
				            pointStrokeColor: "#fff",
				            pointHighlightFill: "#fff",
				            pointHighlightStroke: "rgba(151,187,205,1)",
				            data: data.redeemed
				        }
				    ]
				};
				var ctx = document.getElementById("dashReport").getContext("2d");
				window.myLine = new Chart(ctx).Line(chartData, {
					responsive: true,
					scaleShowVerticalLines: false,
					scaleBeginAtZero : true,
					multiTooltipTemplate: "<%if (label){%><%=datasetLabel%>: <%}%><%= value %>",
				}); 
        	}
		});
	}

	function jumpToLogin(){
		window.location.replace('https://elvinjin.com:8081/panel/login');
	}
	</script>

</body>

</html>